<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
<title>å‹¤å‹™ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¢ãƒ—ãƒª - UI v1</title>
<link rel="stylesheet" href="styles.css?v=20251031">

<link rel="manifest" href="manifest.webmanifest">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#0ea5e9" />
</head>


<body>
  <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
  <section id="loginView" class="view active">
    <div class="card login-card">
      <h1 class="app-title">å‹¤å‹™ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h1>
      <form id="loginForm" autocomplete="off">
        <label class="lbl" for="loginId">ID</label>
        <input id="loginId" class="txt" type="text" required placeholder="ä¾‹ï¼šadmin01"/>

        <label class="lbl" for="loginPw">Passwordï¼ˆ8æ–‡å­—ä»¥ä¸Šï¼‰</label>
        <input id="loginPw" class="txt" type="password" required minlength="8"
               placeholder="8æ–‡å­—ä»¥ä¸Šï¼ˆè¨˜å·ãƒ»æ—¥æœ¬èªOKï¼‰"/>
        <button class="btn btn-primary w-100" type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>

        <p id="loginError" class="error" aria-live="polite"></p>

      </form>

      <!-- â˜…è¿½åŠ ï¼šå‰²ã‚Šå½“ã¦çµæœã¯ã‚¯ãƒ©ã‚¦ãƒ‰ä¿å­˜ã•ã‚Œãªã„æ¡ˆå†… -->
      <div class="login-note" role="note" aria-label="ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã«é–¢ã™ã‚‹é‡è¦ãªãŠçŸ¥ã‚‰ã›">
        <div class="login-note-title">é‡è¦ãªãŠçŸ¥ã‚‰ã›</div>
        <div class="login-note-body">
          å‰²ã‚Šå½“ã¦çµæœï¼ˆå‹¤å‹™è¡¨ï¼‰ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ä¿å­˜ã•ã‚Œã¾ã›ã‚“ã€‚<br>
          åˆ¥ãƒ‡ãƒã‚¤ã‚¹ã§ä½œæ¥­ã™ã‚‹å ´åˆã¯ã€<strong>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ä¿å­˜ â†’ åˆ¥ãƒ‡ãƒã‚¤ã‚¹ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</strong>ã—ã¦ãã ã•ã„ã€‚<br>
          <span class="login-note-sub">â€»å¾“æ¥­å“¡è¨­å®šãƒ»äººæ•°è¨­å®šã®ã¿ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸã•ã‚Œã¾ã™</span>
        </div>
      </div>

      <!-- æŒ‡å—æ›¸ãƒœã‚¿ãƒ³ã‚’è¿½åŠ  -->
      <a href="manual.html" target="_blank" class="btn btn-outline w-100" style="margin-top:12px;">
        ğŸ“˜ æŒ‡å—æ›¸ã‚’é–‹ã
      </a>


      <div id="loginLoading" class="login-loading hidden" aria-live="polite">

        <div class="login-loading-inner">
          <div class="login-loading-icon">ğŸ©º</div>
          <div class="login-loading-text">
            å‹¤å‹™è¡¨ã‚’æº–å‚™ä¸­â€¦
            <span class="dot">.</span><span class="dot">.</span><span class="dot">.</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ã‚¢ãƒ—ãƒªæœ¬ä½“ -->
  <section id="appView" class="view">
    <header class="topbar">
      <div class="left">
        <button id="btnJumpMonth" class="btn btn-ghost" type="button" aria-haspopup="dialog">ä»»æ„ã®æœˆã«ç§»å‹•</button>
        <input id="monthPicker" type="month" class="hidden" />
        <button id="btnPrevDay" class="btn btn-outline" type="button" title="1æ—¥æˆ»ã‚‹">â—€ å‰æ—¥</button>
        <button id="btnNextDay" class="btn btn-outline" type="button" title="1æ—¥é€²ã‚€">ç¿Œæ—¥ â–¶</button>
        <div class="period">è¡¨ç¤ºï¼š<span id="periodText">----</span></div>
      </div>
      <div class="right">
        <button id="btnAttrOpen" class="btn btn-outline" type="button" title="å¾“æ¥­å“¡ã®å±æ€§ã‚’ç·¨é›†">ğŸªª å¾“æ¥­å“¡ç·¨é›†</button>
        <button id="btnCountsOpen" class="btn btn-outline" type="button" title="æ—¥å‹¤ãƒ»å¤œå‹¤ã®äººæ•°è¨­å®š">ğŸ‘¥ äººæ•°è¨­å®š</button>
        <button id="btnAutoAssign" class="btn btn-primary" type="button">ğŸ¤– è‡ªå‹•å‰²ã‚Šå½“ã¦</button>
        <button id="btnCancel" class="btn btn-outline" type="button">âœ– ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="btnGlobalLock" class="btn btn-outline" type="button" title="æŒ‡å®šã•ã‚ŒãŸ4é€±é–“ã‚’ãƒ­ãƒƒã‚¯ï¼ˆç·¨é›†ç¦æ­¢ï¼‰">ğŸ”“ 4é€±é–“ãƒ­ãƒƒã‚¯</button>
       <button id="btnFullCancel" class="btn btn-danger" type="button" title="å®Œå…¨ã‚¯ãƒªã‚¢ï¼ˆ4é€±é–“ã®å…¨ãƒ‡ãƒ¼ã‚¿æ¶ˆå»ï¼‰">ğŸ§¹ å®Œå…¨ã‚¯ãƒªã‚¢</button>
        <button id="btnExportXlsx" class="btn btn-outline" type="button" title="è¡¨ç¤ºä¸­4é€±é–“ã‚’Excelã§å‡ºåŠ›">ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>

                <button id="btnImportData" class="btn btn-outline" type="button" title="CSV/Excelã‹ã‚‰å‰²ã‚Šå½“ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ">ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
        <button id="btnManualSync" class="btn btn-outline" type="button" title="ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°ã¨æœ€æ–°ãƒ‡ãƒ¼ã‚¿åæ˜ ã‚’æ‰‹å‹•å®Ÿè¡Œ">ğŸ”„ æ‰‹å‹•åŒæœŸ</button>
        <button id="btnLogout" class="btn btn-danger" type="button" title="ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã¯è‡ªå‹•ä¿å­˜">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        <button id="installBtn" style="display:none;">ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</button>
      </div>
    </header>


    <div class="toolbar">
      <div class="tool">
        <label for="employeeCount">å¾“æ¥­å“¡æ•°</label>
        <select id="employeeCount" class="select"></select>
      </div>


<!-- è¿½åŠ ï¼šæ—¥æœ¬ã®ç¥æ—¥ã‚’è‡ªå‹•å–å¾— -->
      <div class="tool">
        <button id="btnHolidayAuto" class="btn btn-outline" type="button"
                title="æ—¥æœ¬ã®ç¥æ—¥ã‚’è‡ªå‹•ã§å–ã‚Šè¾¼ã‚€">ç¥æ—¥è‡ªå‹•å–å¾—</button>
      </div>

      <div class="tool">
        <button id="btnLockRange" class="btn btn-outline" type="button"
                title="é¸æŠç¯„å›²ã‚’è‡ªå‹•å‰²å½“ã‹ã‚‰ä¿è­·ï¼ˆä¸Šæ›¸ãã—ãªã„ï¼‰">ç¯„å›²ãƒ­ãƒƒã‚¯</button>
        <button id="btnUnlockRange" class="btn btn-outline" type="button"
                title="é¸æŠç¯„å›²ã®ãƒ­ãƒƒã‚¯ã‚’è§£é™¤">ç¯„å›²ãƒ­ãƒƒã‚¯è§£é™¤</button>
      </div>

<div class="tool">
  <span class="hint">ãƒ¢ãƒ¼ãƒ‰ï¼š</span>
  <label><input type="radio" name="mode" value="off"> å¸Œæœ›ä¼‘</label>
  <label><input type="radio" name="mode" value="assign"> å‰²å½“</label>
  <label><input type="radio" name="mode" value="clear"> ã‚¯ãƒªã‚¢</label>
</div>

      <div class="tool">
        <span class="hint">ç‰¹åˆ¥ä¼‘æš‡ï¼š</span>
        <button id="btnLeaveHoliday" class="btn btn-outline" type="button" title="ç¥æ—¥ã«ä¼‘ã‚“ã äººï¼ˆ4é€±8ä¼‘ã§ã¯å‹¤å‹™æ—¥ã«æ•°ãˆã‚‹ï¼‰">ç¥</button>
        <button id="btnLeaveSub"     class="btn btn-outline" type="button" title="ä»£ä¼‘ï¼ˆ4é€±8ä¼‘ã§ã¯å‹¤å‹™æ—¥ã«æ•°ãˆã‚‹ï¼‰">ä»£</button>
        <button id="btnLeavePaid"    class="btn btn-outline" type="button" title="æœ‰çµ¦ï¼ˆ4é€±8ä¼‘ã§ã¯å‹¤å‹™æ—¥ã«æ•°ãˆã‚‹ï¼‰">å¹´</button>
        <button id="btnLeaveRefresh" class="btn btn-outline" type="button" title="ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ä¼‘æš‡ï¼ˆ4é€±8ä¼‘ã§ã¯å‹¤å‹™æ—¥ã«æ•°ãˆã‚‹ï¼‰">ãƒª</button>
        <span class="hint">â€» ãƒœã‚¿ãƒ³æŠ¼ä¸‹ã§è©²å½“ãƒ¢ãƒ¼ãƒ‰ â†’ ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§è¨­å®š/è§£é™¤ï¼ˆè¨­å®šä¸­ã¯é€šå¸¸æ“ä½œã§ä¸Šæ›¸ãä¸å¯ï¼‰</span>
      </div>

      <div class="tool hint">â€» ãƒ˜ãƒƒãƒ€ãƒ¼æ—¥ä»˜ã‚¯ãƒªãƒƒã‚¯ï¼ç¥æ—¥ãƒˆã‚°ãƒ« / ã€Œå¸Œæœ›ä¼‘ã€ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯ï¼ä¼‘ãƒˆã‚°ãƒ« / ã€Œå‰²å½“ã€ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯ï¼é¸æŠãƒãƒ¼ã‚¯ã‚’é…ç½®ï¼ˆåŒã˜ãƒãƒ¼ã‚¯ã§æ¶ˆå»ï¼‰</div>

<div id="cloudIndicator" class="cloud-indicator" title="ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸçŠ¶æ…‹">æœªæ¥ç¶š</div>


</div>  <!-- â† ã“ã“ã§ .toolbar ã‚’é–‰ã˜ã‚‹ -->


    <div id="gridWrap" class="grid-wrap" tabindex="0" aria-label="å‹¤å‹™è¡¨ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ã§æœˆç§»å‹•ï¼‰">
      <table id="grid" class="grid" aria-describedby="periodText">
        <!-- JSã§æç”» -->

      </table>
    </div>

  </section>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <style>
    .cloud-indicator{
      display:inline-flex; align-items:center; gap:.4rem;
      font-size:12px; padding:2px 8px; border-radius:9999px; border:1px solid #ddd;
    }
    .cloud-indicator::before{ content:""; width:8px; height:8px; border-radius:50%; background:#aaa; }
    .cloud-indicator.online{ color:#065f46; border-color:#a7f3d0; }
    .cloud-indicator.online::before{ background:#10b981; }
    .cloud-indicator.offline{ color:#7f1d1d; border-color:#fecaca; }
    .cloud-indicator.offline::before{ background:#ef4444; }
/* ç‰¹å®šæ—¥å›ºå®šæ¡ä»¶ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å¹…ã‚’çµ±ä¸€ */
.fixed-num-input {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  min-width: 120px;  /* â† 1.5å€ */
}

.fixed-num-input .txt {
  flex: 1;
  min-width: 50px;  /* æœ€å°å¹…ã‚’ç¢ºä¿ */
}
/* ===== ç‰¹å®šæ—¥è¨­å®šï¼šç™»éŒ²æ¸ˆã¿ä¸€è¦§ï¼ˆè¡¨å½¢å¼ï¼‰ ===== */

.fixed-list {
  margin-top: 10px;
}

.fixed-date-list-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
  font-size: 14px;
}

.fixed-date-list-table th,
.fixed-date-list-table td {
  border: 1px solid #ccc;
  padding: 6px 4px;
  text-align: center;
}

.fixed-date-list-table thead th {
  background: #f3f3f3;
  font-weight: 600;
}

.fixed-date-list-table tbody tr:nth-child(even) {
  background: #fafafa;
}

/* æ—¥ä»˜åˆ—ã¯ã‚„ã‚„åºƒã‚ */
.fixed-date-list-table th:first-child,
.fixed-date-list-table td:first-child {
  width: 110px;
}

/* æ•°å€¤å…¥åŠ›æ¬„ */
.fixed-date-list-table input[type="number"] {
  width: 60px;
  padding: 2px 4px;
  box-sizing: border-box;
  text-align: center;
}




/* å‰Šé™¤ãƒœã‚¿ãƒ³åˆ— */
.fixed-date-list-table th:last-child,
.fixed-date-list-table td:last-child {
  width: 56px;
}

.fixed-date-list-table button {
  padding: 2px 6px;
  font-size: 12px;
  cursor: pointer;
}

/* ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ãªã—è¡¨ç¤ºç”¨ */
.fixed-date-list-table .empty-row td {
  text-align: center;
  color: #666;
  padding: 12px 0;
}

/* è£œè¶³èª¬æ˜ */
.fixed-hint {
  margin-top: 6px;
  font-size: 12px;
  color: #555;
}


  </style>

  <!-- å±æ€§ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->


  <dialog id="attrDlg" class="attr">

    <header>å¾“æ¥­å“¡åãƒ»å±æ€§ã®ç·¨é›†</header>
    <div class="content" id="attrContent"></div>
    <footer>
      <button id="attrClose" class="btn btn-outline" type="button">é–‰ã˜ã‚‹</button>
      <button id="attrSave" class="btn btn-accent" type="button">ä¿å­˜</button>
    </footer>
  </dialog>

<dialog id="fullCancelDlg" class="attr">
  <header>å®Œå…¨ã‚¯ãƒªã‚¢</header>
  <div class="content">
    <p>4é€±é–“ã®å‰²å½“ãƒ»å¸Œæœ›ä¼‘ãƒ»ç‰¹åˆ¥ä¼‘æš‡ãƒ»ãƒ­ãƒƒã‚¯ã‚’ã™ã¹ã¦æ¶ˆå»ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</p>
  </div>
  <footer>
    <button id="fullCancelAll"  class="btn btn-danger"  type="button" title="4é€±é–“ã®å‰²å½“ãƒ»å¸Œæœ›ä¼‘ãƒ»ç‰¹åˆ¥ä¼‘æš‡ãƒ»ãƒ­ãƒƒã‚¯ã‚’ã™ã¹ã¦æ¶ˆå»">å®Ÿè¡Œ</button>
    <button id="fullCancelClose" class="btn btn-outline" type="button">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
  </footer>
</dialog>


<dialog id="countsDlg" class="attr">
  <header>äººæ•°è¨­å®š</header>
  <div class="content">
    <div class="row">
      <div class="counts-and-fixed-options">
 
      </div>
    </div>
    <div class="row">
      <div id="countsTableWrapper">
        <table class="counts-table">
          <thead>
            <tr>
              <th></th>
              <th>æ—¥å‹¤å…¨å“¡</th>
              <th>æ—©å‡º</th>
              <th>é…å‡º</th>
              <th>æº–å¤œ</th>
              <th>æ·±å¤œ</th>
            </tr>
          </thead>
          <tbody>
    <tr>
      <th>å¹³æ—¥</th>
      <td><input id="cfgDayTarget" type="number" class="txt" min="0" max="30" step="1"></td>
      <td><input id="cfgEarlyTargetWeekday" type="number" class="txt" min="0" max="30" step="1"></td>
      <td><input id="cfgLateTargetWeekday" type="number" class="txt" min="0" max="30" step="1"></td>
      <td><input id="cfgFixedNF" type="number" class="txt" min="0" max="30" step="1"></td>
      <td><input id="cfgFixedNS" type="number" class="txt" min="0" max="30" step="1"></td>
    </tr>
    <tr>
      <th>åœŸæ—¥ç¥</th>
      <td><input id="cfgDayTargetWkHol" type="number" class="txt" min="0" step="1"></td>
      <td><input id="cfgEarlyTargetWkHol" type="number" class="txt" min="0" step="1"></td>
      <td><input id="cfgLateTargetWkHol" type="number" class="txt" min="0" step="1"></td>
      <td><input id="cfgFixedNFHoliday" type="number" class="txt" min="0" step="1"></td>
      <td><input id="cfgFixedNSHoliday" type="number" class="txt" min="0" step="1"></td>
    </tr>
  </tbody>
</table>



<table class="fixed-date-table">
  <thead>
    <tr>
      <th>æ—¥ä»˜</th>
      <th>æ—¥å‹¤å…¨å“¡</th>
      <th>æ—©å‡º</th>
      <th>é…å‡º</th>
      <th>æº–å¤œ</th>
      <th>æ·±å¤œ</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><input id="cfgFixedDate" type="date" class="txt"></td>
      <td><input id="cfgFixedDay" type="number" class="txt" min="0" max="30" step="1"></td>
      <td><input id="cfgFixedEarlyDate" type="number" class="txt" min="0" max="30" step="1"></td>
      <td><input id="cfgFixedLateDate" type="number" class="txt" min="0" max="30" step="1"></td>
      <td><input id="cfgFixedNFDate" type="number" class="txt" min="0" max="30" step="1"></td>
      <td><input id="cfgFixedNSDate" type="number" class="txt" min="0" max="30" step="1"></td>
      <td>
        <button id="btnFixedByDateAdd" class="btn btn-outline">è¿½åŠ </button>
      </td>
    </tr>
  </tbody>
</table>

        <!-- ç™»éŒ²æ¸ˆã¿ï¼šç‰¹å®šæ—¥è¨­å®šã®ä¸€è¦§ï¼ˆè¡¨å½¢å¼ï¼‰ -->
        <div class="fixed-list">
          <table class="fixed-date-list-table" aria-label="ç‰¹å®šæ—¥è¨­å®šï¼ˆç™»éŒ²æ¸ˆã¿ä¸€è¦§ï¼‰">
            <thead>
              <tr>
                <th>æ—¥ä»˜</th>
                <th>æ—¥å‹¤å…¨å“¡</th>
                <th>æ—©å‡º</th>
                <th>é…å‡º</th>
                <th>æº–å¤œ</th>
                <th>æ·±å¤œ</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="fixedByDateListBody">
              <!-- JSã§æç”» -->
            </tbody>
          </table>
          <div class="fixed-hint">
            ä¸Šã®è¡Œã§å…¥åŠ› â†’ ã€Œè¿½åŠ ã€ã€‚ç™»éŒ²æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã¯ã“ã®è¡¨ã§ç¢ºèªãƒ»ä¿®æ­£ãƒ»å‰Šé™¤ã§ãã¾ã™ã€‚
          </div>
        </div>

        <!-- äº’æ›ç”¨ï¼šå†…éƒ¨ä¿å­˜ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è¦‹ã›ãªã„ï¼‰ -->
        <textarea id="cfgFixedByDate" class="txt fixed-text" rows="4" style="display:none;"
                  aria-hidden="true"></textarea>
      </div>




  <footer>

    <button id="countsClose" class="btn btn-outline" type="button">é–‰ã˜ã‚‹</button>
    <button id="countsSave"  class="btn btn-accent"  type="button">ä¿å­˜</button>

    </footer>
  </dialog>

  <script src="marks.js"></script>
  <script src="shiftDurations.js"></script>
  <script src="counts.config.js"></script>
  <script src="rules.js"></script>
  <script src="holidayRules.js"></script>
  <script src="assignRules.js"></script>
  <script src="nightBand.js"></script>
  <script src="core.dates.js"></script>


  <script>
    window.REMOTE_ENDPOINT = "https://script.google.com/macros/s/AKfycbyIhYVUv8McMdZknoCHtpuXsGp-T7Xcg4txHna5WaQatbBrkr3FDOvZeBDjbpi96vpA/exec";
  </script>
<script>
  window.SUPABASE_URL = "https://ilaengwzbcfdsmxbgcvt.supabase.co";
  window.SUPABASE_ANON_KEY = "sb_publishable_igRtPqWDgnCGldBN61flkQ_AEXjgPl5";
</script>
  <script src="gasClient.js"></script>
  <script src="auth.js"></script>
  <script src="pwa.js"></script>
  <script src="employeeDialog.js"></script>
  <script src="dataExportImport.js"></script>
  <script src="app-core.js"></script>        
  <script src="app-utils.js"></script>       
  <script src="app-init.js"></script>        
  <script src="app-storage.js"></script>     
  <script src="app-render.js"></script>      
  <script src="app-navigation.js"></script>  
  <script src="app-dialog.js"></script>      
  <script src="app-export.js"></script>   
  <script src="buttonHandlers.js"></script>
  <script src="cellOperations.js"></script>
  <script src="autoAssignLogic.js"></script>

  <script>
    // æ‰‹å‹•åŒæœŸï¼šService Worker æ›´æ–° + ã‚­ãƒ£ãƒƒã‚·ãƒ¥å†å–å¾—ï¼ˆå¯èƒ½ãªã‚‰ï¼‰
    (function(){
      const btn = document.getElementById('btnManualSync');
      if(!btn) return;

      const indicator = document.getElementById('cloudIndicator');

      function toast(msg){
        if (typeof window.showToast === 'function') {
          try { window.showToast(msg); return; } catch(_) {}
        }
        const el = document.getElementById('toast');
        if(!el){ alert(msg); return; }
        el.textContent = msg;
        el.classList.add('show');
        setTimeout(() => el.classList.remove('show'), 2200);
      }

      async function manualSync(){
        try{
          if(indicator) indicator.classList.add('syncing');
          toast('åŒæœŸä¸­â€¦');

          if(!('serviceWorker' in navigator)){
            toast('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯åŒæœŸã«æœªå¯¾å¿œã§ã™');
            return;
          }

          const reg = await navigator.serviceWorker.getRegistration();
          if(!reg){
            toast('Service Worker ãŒæœªç™»éŒ²ã§ã™');
            return;
          }

          await reg.update();

          if(reg.active){
            reg.active.postMessage({ type: 'MANUAL_SYNC' });
          }

          setTimeout(() => location.reload(), 600);
        }catch(e){
          console.error(e);
          toast('åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸ');
        }finally{
          if(indicator) indicator.classList.remove('syncing');
        }
      }

      btn.addEventListener('click', manualSync);
    })();
  </script>
</body>
</html>
